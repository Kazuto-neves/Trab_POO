#include <iostream>
#include <iomanip>
#include <cstring>
#include <cstdlib>
#include <string>

using namespace std;

class Item{
    private:
       string Titulo,estilo,Produtora,midia;
       int ano, codigo;
    public:
        virtual void ler();
        virtual double aluguel() = 0;
        virtual string getClasse(){return "Item"};
        string getTitulo(){return Titulo};
        string getEstilo(){return estilo};
        string getProdutora(){return Produtora};
        string getMidia(){return Midia};
        int getCodigo(){return codigo};
        int getAno(){return ano};
};

void Item::ler(){
    cout << "Codigo: "; cin >> codigo;
    cout << "Titulo: "; cin.ignore();   getline(cin, Titulo);
    cout << "Estilo: ";   getline(cin, estilo);
    cout << "Produtora: ";   getline(cin, Produtora);
    cout << "Midia: ";   getline(cin, Midia);
    cout << "Ano de Lacamento: ";   cin >> ano;
}


class Jogo : public Item {
    protected:
        int n_jogadores;
        string plataforma;
    public:
    void ler();
	virtual string getClasse()	    { return "Jogo";         }
    virtual double aluguel();
};

void Jogo::ler(){
    Item::ler();
    cout << "Numero de jogadores: "; cin >> n_jogadores;
    cout << "Plataforma: "; cin.ignore();   getline(cin, plataforma);
}

double Jogo::aluguel(){
    if(plataforma)

}

class Filme : public Item {
    protected:
        string ator,diretor;
    public:
        void ler();
	virtual string getClasse(){return "Filme"};
        virtual double aluguel(){return getAno() <2020?5:7};
};

void Jogo::ler(){
    Item::ler();
    cout << "Ator Principal: "; getline(cin, ator);
    cout << "Diretor: "; getline(cin, diretor);
}

class Locadora {
    private:
        IAlugavel* v[100];
        int qtd;
        int obterIndice(int busca);

    public:
        Locadora();
        virtual ~Locadora();
        bool existe(int busca);
        void inserir(IAlugavel* d);
        void remover(int busca);
        void alterar(IAlugavel* d, int busca);
        void listar();
        void listarJ();
        void listartp3nota();
};

Locadora::Locadora(){qtd = 0;}

Locadora::~Locadora(){
    for (int i = 0; i < qtd; i++)delete v[i];
}


void Locadora::inserir(IAlugavel* d){
    v[qtd] = d;
    qtd++;
}

int Locadora::obterIndice(int busca){
    bool achou = false;
    int i = 0;
    while (!achou && i < qtd){
        if (busca == v[i]->getCodigo()) achou = true;
        else    i++;
    }
    return achou ? i : -1;
}

bool Locadora::existe(int busca){return obterIndice(busca) > -1;}

void Locadora::remover(int busca){
    int pos = obterIndice(busca);
    delete v[pos];
    for (int i = pos + 1; i < qtd; i++)v[i-1] = v[i];
    qtd--;
}

void Locadora::alterar(IAlugavel* d, int busca){
    int pos = obterIndice(busca);
    delete v[pos];
    v[pos] = d;
}

void Locadora::listar(){
    cout << "Cod. Nome " << setfill(' ') << setw(63) << right << "Cred  Ano/S Media" << endl;
    for (int i = 0; i < qtd; i++){
        cout << setprecision(2) << fixed;
        cout << setfill('0') << setw(4) << right << v[i]->getCodigo() << " ";
        cout << setfill(' ') << setw(54) << left << v[i]->getNome();
        cout << right << v[i]->getCreditos() << " " << right << v[i]->getAno() << "/" << v[i]->getSemestre() << " ";
        cout << setfill('0') << setw(5) << v[i]->media() << endl;
    }
}

void Locadora::listarJ(string x){
    cout << "Cod. Titulo " << setfill(' ') << setw(63) << right << "Plataforma" << endl;
    for (int i = 0; i < qtd; i++)
	if (v[i]->getClasse()=="Jogo" && v[i]->get){
           cout << setprecision(2) << fixed;
           cout << setfill('0') << setw(4) << right << v[i]->getCodigo() << " ";
           cout << setfill(' ') << setw(54) << left << v[i]->getNome();
           cout << right << v[i]->getCreditos() << " " << right << v[i]->getAno() << "/" << v[i]->getSemestre() << " ";
           cout << setfill('0') << setw(5) << v[i]->media() << endl;
        }
}

void Locadora::listartp3nota(){
    cout << "Cod. Nome " << setfill(' ') << setw(63) << right << "Cred  Ano/S Media" << endl;
    for (int i = 0; i < qtd; i++)
	if (v[i]->getClasse()=="Tipo3" && ((Tipo3*)v[i])->getNotaApresentacao()>7 )
        {
           cout << setprecision(2) << fixed;
           cout << setfill('0') << setw(4) << right << v[i]->getCodigo() << " ";
           cout << setfill(' ') << setw(54) << left << v[i]->getNome();
           cout << right << v[i]->getCreditos() << " " << right << v[i]->getAno() << "/" << v[i]->getSemestre() << " ";
           cout << setfill('0') << setw(5) << v[i]->media() << endl;
        }
}


IAlugavel* Adicionar(){
    int opc;
    do{
        cout << "1 - Jogo" << endl;
        cout << "2 - Filme" << endl;
        cout << "Escolha uma opcao: ";
        cin >> opc;
    } while (opc < 1 || opc > 2);
    switch (opc){
        case 1: return new Jogo();
        case 2: return new Filme();
        default:
            cout << endl << "Opcao invalida!" << endl;
            exit(0);
    }
}

int menu(){
    int opc;
    do{
        cout << "1. inserir" << endl
             << "2. remover pelo codigo" << endl
             << "3. alterar dados dado o codigo" << endl
             << "4. listar os itens onde eh dada uma parte da informacao" << endl
             << "5. listar os jogos de uma plataforma" << endl
             << "6. mostrar o valor do aluguel dado o codigo" << endl
             << "7. Sair" << endl
             << "Escolha uma opcao: ";
        cin >> opc;
    } while (opc < 1 || opc > 7);

    return opc;
}

int main(){
    IAlugavel* d;
    Locadora h;
    bool fim = false;
    int buscar;
    while (!fim){
        switch (menu()){
        case 1:
            d = Adicionar();
            d->ler();
            h.inserir(d);
            cout << "Inserida com sucesso!" << endl; break;
        case 2:
            cout << "Digite o codigo do item a ser removida: ";
            cin >> buscar;
            if(h.existe(buscar)){
                h.remover(buscar);
                cout << "Removida com sucesso!" << endl;              
            }else
                cout << "Nao encontrada!" << endl; break;
        case 3:
            cout << "Digite o codigo do item a ser alterada: ";
            cin >> buscar;
            if(h.existe(buscar)){
                d->ler();
                h.alterar(d, buscar);
                cout << "Alterada com sucesso!" << endl;
            }else
                cout << "Nao encontrada!" << endl; break;
        case 4:
            h.listar();
            system("pause"); break;
        case 5:
            h.listartp2();                                          
            system("pause"); break;
        case 6:
            h.listartp3nota(); 
            system("pause"); break;
        case 7:
            fim = true; break;
        default:
            cout << "Opcao invalida!" << endl; break;
        }
    }
}